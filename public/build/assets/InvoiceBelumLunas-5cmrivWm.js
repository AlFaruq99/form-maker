import{Z as M,i as B,d as p,e as _,o as i,c as r,b as e,a as v,w as g,g as u,k as x,F as f,r as m,f as y,v as H,t as n,h as k,l as S,m as I,j,n as V}from"./app-MfvSOTyN.js";import{T as z}from"./Table-UwcRM0Td.js";import{h as L}from"./moment-WSJ9un1t.js";import{T as N}from"./Toast-0A_An8To.js";import{B as P}from"./ButtonSendMail-wMk-zbHU.js";import{_ as U}from"./_plugin-vue_export-helper-x3n3nnut.js";const G={components:{TableVue:z,Head:M,Link:B,Toast:N,ButtonSendMail:P},props:{userId:Number,level:String},data(){return{invoiceData:[],length:10,selectedInvoice:[],search:null,selectedStatus:null,status:{itemId:null,type:"idle"}}},mounted(){this.fetchInvoice()},watch:{length(){this.fetchInvoice()},search(a){a!=null&&a!=""&&this.fetchInvoice()}},methods:{changePageHandler(a){let s=new URL(a);s.searchParams.set("length",this.length),s.searchParams.set("user_id",this.userId),this.fetchInvoice(s.href)},async fetchInvoice(a){let s;a?s=a:s=route("client.invoice.fetchInvoice",{_query:{status:"belum_bayar",length:this.length,search:this.search,user_id:this.userId}});try{const h=await p.get(s).then(l=>l).catch(l=>{console.log(l)});h.status==200&&(this.invoiceData=h.data,this.invoiceData.data=this.invoiceData.data.map(l=>(l.total=parseFloat(l.total).toLocaleString("id-ID",{style:"currency",currency:"IDR"}),l.tanggal_invoice=L(l.created_at).format("DD-MM-YYYY"),console.log(l),l)))}catch{}},async massDeleteHandler(){try{(await p.post(route("client.invoice.destroy"),{list:this.selectedInvoice}).catch(s=>{console.log(s)})).status==200&&(this.fetchInvoice(),this.selectedInvoice=[],this.$refs.toast.show("success","Behasil menghapus faktur yang dipilih",""),setTimeout(()=>{this.$refs.toast.hide()},5e3))}catch{this.$refs.toast.show("error","Gagal menghapus faktur yang dipilih",""),setTimeout(()=>{this.$refs.toast.hide()},5e3)}},async updateStatusHandler(){try{(await p.post(route("client.invoice.update"),{listId:this.selectedInvoice,status:this.selectedStatus})).status==200?(this.selectedInvoice=[],this.fetchInvoice(),this.$refs.toast.show("success","Behasil mengubah status faktur","buka tab status"),setTimeout(()=>{this.$refs.toast.hide()},5e3)):(this.$refs.toast.show("error","Gagal mengubah status faktur","coba beberapa saat lagi atau hubungi cs"),setTimeout(()=>{this.$refs.toast.hide()},5e3))}catch{this.$refs.toast.show("error","Gagal mengubah status faktur","coba beberapa saat lagi atau hubungi cs"),setTimeout(()=>{this.$refs.toast.hide()},5e3)}},async sendWhastappMedia(a){try{this.status={itemId:a.id,type:"loading"},await p.get(route("client.invoice.sendMedia",{id:a.id,number:a.d_phone_number})).then(s=>{console.log(s),this.status={itemId:null,type:"idle"},this.$refs.toast.show("success","Behasil mengirim faktur ke wa tujuan","konfirmasi pada nomor tujuan bahwa faktur telah dikirimkan"),setTimeout(()=>{this.$refs.toast.hide()},5e3)}).catch(s=>{console.log(s),this.status={itemId:null,type:"idle"},this.$refs.toast.show("error","Gagal mengirim faktur ke wa tujuan","coba beberapa saat lagi atau hubungi cs"),setTimeout(()=>{this.$refs.toast.hide()},5e3)})}catch{this.$refs.toast.show("error","Gagal mengirim faktur ke wa tujuan","coba beberapa saat lagi atau hubungi cs"),setTimeout(()=>{this.$refs.toast.hide()},5e3)}},async sendMailMedia(a){this.$emit("sending",{isOpen:!0,status:"loading",message:"Mengirim email ke tujuan"});try{(await p.post(route("client.mail.sendInvoice"),{id:a.id,from_name:a.s_company_name,from_email:a.s_email,recipient:a.d_email,subject:"noreply",content:"Lampiran Faktur"})).status=="200"&&setTimeout(()=>{this.$emit("sending",{isOpen:!0,status:"success",message:"Berhasil mengirim email ke tujuan"},1e3)})}catch{setTimeout(()=>{this.$emit("sending",{isOpen:!0,status:"error",message:"Gagal mengirim email ke tujuan"})},1e3)}setTimeout(()=>{this.$emit("sending",{isOpen:!1})},5e3)}}},q={class:"grid grid-cols-1 w-full gap-6 col-span-3"},F={class:"card bg-white p-6 grid grid-cols-1 gap-6"},O=e("p",{class:"font-semibold"},"Belum bayar",-1),Y={class:"container"},A=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"})],-1),W={class:"container filter-container flex flex-row justify-between"},R={class:"inline-flex space-x-1"},E=e("option",{value:"10"},"10",-1),J=["value","hidden"],K={key:0,class:"w-full inline-flex px-2 space-x-4"},Z=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21zm2-4h2V8H9zm4 0h2V8h-2z"})],-1),Q=[Z],X=e("div",{class:"divider divider-horizontal"},null,-1),$={class:"inline-flex space-x-2"},ee=e("option",{value:"dp",selected:""},"DP",-1),te=e("option",{value:"lunas"},"Lunas",-1),se=[ee,te],ae={class:"inline-flex space-x-2"},oe={class:"container grid grid-cols-1 gap-6"},ne=e("thead",null,[e("tr",null,[e("th"),e("th",null,"No."),e("th",null,"Nomor Invoice"),e("th"),e("th",null,"Dari"),e("th"),e("th",null,"Kepada"),e("th",null,"Tanggal Dibuat"),e("th",null,"Jumlah Item"),e("th",null,"Total Harus Dibayar"),e("th")])],-1),le=["value"],ie={class:"inline-flex space-x-2"},re=["onClick"],ce={xmlns:"http://www.w3.org/2000/svg",class:"w-6 text-primary",viewBox:"0 0 24 24"},de=e("path",{fill:"none",stroke:"currentColor","stroke-dasharray":"15","stroke-dashoffset":"15","stroke-linecap":"round","stroke-width":"2",d:"M12 3C16.9706 3 21 7.02944 21 12"},[e("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.3s",values:"15;0"}),e("animateTransform",{attributeName:"transform",dur:"1.5s",repeatCount:"indefinite",type:"rotate",values:"0 12 12;360 12 12"})],-1),ue=[de],he={xmlns:"http://www.w3.org/2000/svg",class:"w-6 text-primary",viewBox:"0 0 24 24"},pe=e("path",{fill:"currentColor",d:"M19.05 4.91A9.816 9.816 0 0 0 12.04 2c-5.46 0-9.91 4.45-9.91 9.91c0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21c5.46 0 9.91-4.45 9.91-9.91c0-2.65-1.03-5.14-2.9-7.01m-7.01 15.24c-1.48 0-2.93-.4-4.2-1.15l-.3-.18l-3.12.82l.83-3.04l-.2-.31a8.264 8.264 0 0 1-1.26-4.38c0-4.54 3.7-8.24 8.24-8.24c2.2 0 4.27.86 5.82 2.42a8.183 8.183 0 0 1 2.41 5.83c.02 4.54-3.68 8.23-8.22 8.23m4.52-6.16c-.25-.12-1.47-.72-1.69-.81c-.23-.08-.39-.12-.56.12c-.17.25-.64.81-.78.97c-.14.17-.29.19-.54.06c-.25-.12-1.05-.39-1.99-1.23c-.74-.66-1.23-1.47-1.38-1.72c-.14-.25-.02-.38.11-.51c.11-.11.25-.29.37-.43s.17-.25.25-.41c.08-.17.04-.31-.02-.43s-.56-1.34-.76-1.84c-.2-.48-.41-.42-.56-.43h-.48c-.17 0-.43.06-.66.31c-.22.25-.86.85-.86 2.07c0 1.22.89 2.4 1.01 2.56c.12.17 1.75 2.67 4.23 3.74c.59.26 1.05.41 1.41.52c.59.19 1.13.16 1.56.1c.48-.07 1.47-.6 1.67-1.18c.21-.58.21-1.07.14-1.18s-.22-.16-.47-.28"},null,-1),_e=[pe],ve=e("div",{class:"divider divider-horizontal"},null,-1),ge=["href"],fe=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 text-orange-400",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"})],-1),me=[fe],we=["href"],be=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 text-orange-600",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})],-1),xe=[be],ye={class:"flex flex-col"},ke={class:"font-semibold"},Ie={class:"text-gray-500"},Te=e("td",null,[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6",viewBox:"0 0 50 50"},[e("path",{fill:"currentColor",d:"M25 42c-9.4 0-17-7.6-17-17S15.6 8 25 8s17 7.6 17 17s-7.6 17-17 17m0-32c-8.3 0-15 6.7-15 15s6.7 15 15 15s15-6.7 15-15s-6.7-15-15-15"}),e("path",{fill:"currentColor",d:"m24.7 34.7l-1.4-1.4l8.3-8.3l-8.3-8.3l1.4-1.4l9.7 9.7z"}),e("path",{fill:"currentColor",d:"M16 24h17v2H16z"})])],-1),Ce={class:"flex flex-col"},De={class:"font-semibold text-blue-600"},Me={class:"text-gray-500"},Be={class:"w-full sm:flex sm:flex-row sm:justify-between grid grid-cols-1 gap-4"},He={class:"max-sm:hidden join w-fit"},Se=["onClick","innerHTML"],je={class:"w-full join sm:hidden justify-center"};function Ve(a,s,h,l,o,c){const w=_("Link"),T=_("ButtonSendMail"),C=_("TableVue"),D=_("Toast");return i(),r(f,null,[e("div",q,[e("div",F,[O,e("div",Y,[v(w,{href:a.route("client.invoice.clientCreate",{_query:{status:"belum_bayar"}}),class:"btn btn-md btn-primary float-end"},{default:g(()=>[A,k(" Buat Invoice ")]),_:1},8,["href"])]),e("div",W,[e("div",R,[u(e("select",{class:"select select-bordered w-fit max-w-xs","onUpdate:modelValue":s[0]||(s[0]=t=>o.length=t)},[E,(i(),r(f,null,m(100,(t,d)=>e("option",{value:t,hidden:t%25!=0,key:d},n(t),9,J)),64))],512),[[x,o.length]])]),o.selectedInvoice.length>0?(i(),r("div",K,[e("button",{class:"btn tooltip",onClick:s[1]||(s[1]=(...t)=>c.massDeleteHandler&&c.massDeleteHandler(...t)),"data-tip":"hapus data"},Q),X,e("div",$,[u(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.selectedStatus=t),class:"select select-bordered w-full max-w-xs"},se,512),[[x,o.selectedStatus]]),e("button",{onClick:s[3]||(s[3]=(...t)=>c.updateStatusHandler&&c.updateStatusHandler(...t)),class:"btn bg-emerald-500 text-white"},"Ubah status")])])):y("",!0),e("div",ae,[u(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.search=t),type:"text",name:"",class:"input input-bordered input-md w-full max-w-xs",placeholder:"Search..."},null,512),[[H,o.search]])])]),e("div",oe,[v(C,null,{header:g(()=>[ne]),body:g(()=>[e("tbody",null,[(i(!0),r(f,null,m(o.invoiceData.data,(t,d)=>(i(),r("tr",{class:"whitespace-nowrap",key:d},[e("td",null,[u(e("input",{"onUpdate:modelValue":s[5]||(s[5]=b=>o.selectedInvoice=b),value:t.id,type:"checkbox",class:"checkbox checkbox-primary"},null,8,le),[[S,o.selectedInvoice]])]),e("td",null,n(o.invoiceData.from+d),1),e("td",null,n(t==null?void 0:t.no_invoice),1),e("td",null,[e("div",ie,[e("button",{onClick:b=>c.sendWhastappMedia(t),class:"tooltip","data-tip":"Bagikan Whatsapp"},[u((i(),r("svg",ce,ue,512)),[[I,o.status.type=="loading"&&o.status.itemId==t.id]]),u((i(),r("svg",he,_e,512)),[[I,o.status.type=="idle"]])],8,re),v(T,{"user-level":h.level,"data-id":t.id},null,8,["user-level","data-id"]),ve,e("a",{href:a.route("client.invoice.preview",t.id),target:"_blank"},me,8,ge),e("a",{href:a.route("client.invoice.download",t.id),class:"tooltip","data-tip":"Unduh"},xe,8,we)])]),e("td",null,[e("div",ye,[e("span",ke,n(t==null?void 0:t.s_company_name),1),e("span",Ie,n((t==null?void 0:t.s_company_address)+" - "+(t==null?void 0:t.s_phone_number)),1)])]),Te,e("td",null,[e("div",Ce,[e("span",De,n(t==null?void 0:t.d_company_name),1),e("span",Me,n((t==null?void 0:t.d_company_address)+" - "+(t==null?void 0:t.d_phone_number)),1)])]),e("td",null,n(t==null?void 0:t.tanggal_invoice),1),e("td",null,n(t==null?void 0:t.item.length),1),e("td",null,n(t==null?void 0:t.total),1),e("td",null,[t.status=="Inactive"?(i(),j(w,{key:0,href:a.route("client.user.userActivation",{id:t.id}),class:"btn btn-sm text-white bg-blue-500"},{default:g(()=>[k("Activate")]),_:2},1032,["href"])):y("",!0)])]))),128))])]),_:1}),e("div",Be,[e("p",null," Show "+n(o.invoiceData.from)+" - "+n(o.invoiceData.to)+" form total "+n(o.invoiceData.total)+" data ",1),e("div",He,[(i(!0),r(f,null,m(o.invoiceData.links,(t,d)=>(i(),r("div",{key:d},[e("button",{onClick:()=>{c.changePageHandler(t.url)},class:V(["join-item btn btn-sm",{"bg-primary text-white":t.active}]),innerHTML:t.label},null,10,Se)]))),128))]),e("div",je,[e("button",{class:"join-item btn",onClick:s[6]||(s[6]=t=>c.changePageHandler(o.invoiceData.prev_page_url))},"Prev Page"),e("button",{class:"join-item btn",onClick:s[7]||(s[7]=t=>c.changePageHandler(o.invoiceData.next_page_url))},"Next Page")])])])])]),v(D,{ref:"toast"},null,512)],64)}const qe=U(G,[["render",Ve]]);export{qe as default};
